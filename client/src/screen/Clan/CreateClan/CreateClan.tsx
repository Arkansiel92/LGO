import './CreateClan.css';
import Navbar from "../../../component/Navbar/Navbar";
import green_banner_01 from "../../../assets/img/banner/green/green_banner_01.png";
import green_banner_02 from "../../../assets/img/banner/green/green_banner_02.png";
import green_banner_03 from "../../../assets/img/banner/green/green_banner_03.png";
import green_banner_04 from "../../../assets/img/banner/green/green_banner_04.png";
import blue_banner_01 from "../../../assets/img/banner/blue/blue_banner_01.png";
import blue_banner_02 from "../../../assets/img/banner/blue/blue_banner_02.png";
import blue_banner_03 from "../../../assets/img/banner/blue/blue_banner_03.png";
import blue_banner_04 from "../../../assets/img/banner/blue/blue_banner_04.png";
import orange_banner_01 from "../../../assets/img/banner/orange/orange_banner_01.png";
import orange_banner_02 from "../../../assets/img/banner/orange/orange_banner_02.png";
import orange_banner_03 from "../../../assets/img/banner/orange/orange_banner_03.png";
import orange_banner_04 from "../../../assets/img/banner/orange/orange_banner_04.png";
import pink_banner_01 from "../../../assets/img/banner/pink/pink_banner_01.png";
import pink_banner_02 from "../../../assets/img/banner/pink/pink_banner_02.png";
import pink_banner_03 from "../../../assets/img/banner/pink/pink_banner_03.png";
import pink_banner_04 from "../../../assets/img/banner/pink/pink_banner_04.png";
import red_banner_01 from "../../../assets/img/banner/red/red_banner_01.png";
import red_banner_02 from "../../../assets/img/banner/red/red_banner_02.png";
import red_banner_03 from "../../../assets/img/banner/red/red_banner_03.png";
import red_banner_04 from "../../../assets/img/banner/red/red_banner_04.png";
import white_emblem_01 from "../../../assets/img/emblem/white/white_emblem_01.png";
import white_emblem_02 from "../../../assets/img/emblem/white/white_emblem_02.png";
import white_emblem_03 from "../../../assets/img/emblem/white/white_emblem_03.png";
import white_emblem_04 from "../../../assets/img/emblem/white/white_emblem_04.png";
import white_emblem_05 from "../../../assets/img/emblem/white/white_emblem_05.png";
import white_emblem_06 from "../../../assets/img/emblem/white/white_emblem_06.png";
import white_emblem_07 from "../../../assets/img/emblem/white/white_emblem_07.png";
import white_emblem_08 from "../../../assets/img/emblem/white/white_emblem_08.png";
import white_emblem_09 from "../../../assets/img/emblem/white/white_emblem_09.png";
import white_emblem_10 from "../../../assets/img/emblem/white/white_emblem_10.png";
import white_emblem_11 from "../../../assets/img/emblem/white/white_emblem_11.png";
import white_emblem_12 from "../../../assets/img/emblem/white/white_emblem_12.png";
import white_emblem_13 from "../../../assets/img/emblem/white/white_emblem_13.png";
import white_emblem_14 from "../../../assets/img/emblem/white/white_emblem_14.png";
import white_emblem_15 from "../../../assets/img/emblem/white/white_emblem_15.png";
import white_emblem_16 from "../../../assets/img/emblem/white/white_emblem_16.png";
import white_emblem_17 from "../../../assets/img/emblem/white/white_emblem_17.png";
import white_emblem_18 from "../../../assets/img/emblem/white/white_emblem_18.png";
import white_emblem_19 from "../../../assets/img/emblem/white/white_emblem_19.png";
import white_emblem_20 from "../../../assets/img/emblem/white/white_emblem_20.png";
import white_emblem_21 from "../../../assets/img/emblem/white/white_emblem_21.png";
import white_emblem_22 from "../../../assets/img/emblem/white/white_emblem_22.png";
import white_emblem_23 from "../../../assets/img/emblem/white/white_emblem_23.png";
import white_emblem_24 from "../../../assets/img/emblem/white/white_emblem_24.png";
import white_emblem_25 from "../../../assets/img/emblem/white/white_emblem_25.png";
import white_emblem_26 from "../../../assets/img/emblem/white/white_emblem_26.png";
import white_emblem_27 from "../../../assets/img/emblem/white/white_emblem_27.png";
import white_emblem_28 from "../../../assets/img/emblem/white/white_emblem_28.png";
import white_emblem_29 from "../../../assets/img/emblem/white/white_emblem_29.png";
import white_emblem_30 from "../../../assets/img/emblem/white/white_emblem_30.png";
import white_emblem_31 from "../../../assets/img/emblem/white/white_emblem_31.png";
import white_emblem_32 from "../../../assets/img/emblem/white/white_emblem_32.png";
import white_emblem_33 from "../../../assets/img/emblem/white/white_emblem_33.png";
import white_emblem_34 from "../../../assets/img/emblem/white/white_emblem_34.png";
import white_emblem_35 from "../../../assets/img/emblem/white/white_emblem_35.png";
import white_emblem_36 from "../../../assets/img/emblem/white/white_emblem_36.png";
import white_emblem_37 from "../../../assets/img/emblem/white/white_emblem_37.png";
import white_emblem_38 from "../../../assets/img/emblem/white/white_emblem_38.png";
import white_emblem_39 from "../../../assets/img/emblem/white/white_emblem_39.png";
import white_emblem_40 from "../../../assets/img/emblem/white/white_emblem_40.png";
import white_emblem_41 from "../../../assets/img/emblem/white/white_emblem_41.png";
import white_emblem_42 from "../../../assets/img/emblem/white/white_emblem_42.png";
import white_emblem_43 from "../../../assets/img/emblem/white/white_emblem_43.png";
import white_emblem_44 from "../../../assets/img/emblem/white/white_emblem_44.png";
import white_emblem_45 from "../../../assets/img/emblem/white/white_emblem_45.png";
import white_emblem_46 from "../../../assets/img/emblem/white/white_emblem_46.png";
import white_emblem_47 from "../../../assets/img/emblem/white/white_emblem_47.png";
import white_emblem_48 from "../../../assets/img/emblem/white/white_emblem_48.png";
import white_emblem_49 from "../../../assets/img/emblem/white/white_emblem_49.png";
import white_emblem_50 from "../../../assets/img/emblem/white/white_emblem_50.png";
import { useForm } from "react-hook-form";
import { useContext, useEffect, useState } from "react";
import Footer from "../../../component/Footer/Footer";
import { AuthContext } from '../../../context/auth';
import { useNavigate } from 'react-router-dom';

interface credentials {
    name: string,
    description: string,
    banner?: string,
    emblem?: string
}

interface player {
    id: number
}

function CreateClan() {

    const banners = [
        green_banner_01,
        green_banner_02,
        green_banner_03,
        green_banner_04,
        blue_banner_01,
        blue_banner_02,
        blue_banner_03,
        blue_banner_04,
        orange_banner_01,
        orange_banner_02,
        orange_banner_03,
        orange_banner_04,
        pink_banner_01,
        pink_banner_02,
        pink_banner_03,
        pink_banner_04,
        red_banner_01,
        red_banner_02,
        red_banner_03,
        red_banner_04
    ]

    const emblems = [
        white_emblem_01,
        white_emblem_02,
        white_emblem_03,
        white_emblem_04,
        white_emblem_05,
        white_emblem_06,
        white_emblem_07,
        white_emblem_08,
        white_emblem_09,
        white_emblem_10,
        white_emblem_11,
        white_emblem_12,
        white_emblem_13,
        white_emblem_14,
        white_emblem_15,
        white_emblem_16,
        white_emblem_17,
        white_emblem_18,
        white_emblem_19,
        white_emblem_20,
        white_emblem_21,
        white_emblem_22,
        white_emblem_23,
        white_emblem_24,
        white_emblem_25,
        white_emblem_26,
        white_emblem_27,
        white_emblem_28,
        white_emblem_29,
        white_emblem_30,
        white_emblem_31,
        white_emblem_32,
        white_emblem_33,
        white_emblem_34,
        white_emblem_35,
        white_emblem_36,
        white_emblem_37,
        white_emblem_38,
        white_emblem_39,
        white_emblem_40,
        white_emblem_41,
        white_emblem_42,
        white_emblem_43,
        white_emblem_44,
        white_emblem_45,
        white_emblem_46,
        white_emblem_47,
        white_emblem_48,
        white_emblem_49,
        white_emblem_50,
    ]

    const { handleSubmit, register, formState: { errors } } = useForm<credentials>();
    const [banner, setBanner] = useState(green_banner_01);
    const [emblem, setEmblem] = useState(white_emblem_01);
    const [player, setPlayer] = useState<player | null>(null);
    const auth = useContext(AuthContext);
    const navigate = useNavigate();

    const onSubmit = (credentials: credentials) => {
        credentials.banner = banner;
        credentials.emblem = emblem;

        fetch('https://localhost:8000/api/clans', {
            method:'POST',
            headers: {
                'Content-Type':'application/json'
            },
            body: JSON.stringify(credentials)
        })
        .then(res => res.json())
        .then(data => {
            if (data.id) {
                fetch('https://localhost:8000/api/members_clans', {
                    method:'POST',
                    headers: {
                        'Content-Type':'application/json'
                    },
                    body: JSON.stringify({
                        user: 'api/users/' + player?.id,
                        clan: 'api/clans/' + data.id,
                        rankClan: 'api/rank_clans/1'
                    })
                })
                .then(res => {if(res.ok) return navigate('/')})
                .catch(e => console.log(e))
            }
        })
    }

    useEffect(() => {
        if (!player) {
            fetch('https://localhost:8000/api/users?username=' + auth.authState.user?.username, {
                method: 'GET',
                headers: {
                    'accept' : 'application/json'
                }
            })
            .then(res => res.json())
            .then(data => {
                setPlayer(data[0])
            })

        }
    })

    return (
        <div>
            <Navbar />
            <div className="container">
                <div className="row">
                    <div className="col-4 text-center position-relative">
                        <img className="banner-village" src={banner} alt="" />
                        <img className="emblem-village" src={emblem} alt="" />
                    </div>
                    <div className="col card bg-dark box-shadow">
                        <div className="card-body">
                            <h1>Créer un village</h1>
                            <form onSubmit={handleSubmit(onSubmit)}>
                                <div className="group-form">
                                    <label htmlFor="name" className="form-label">
                                        Nom du village
                                    </label>
                                    <input type="text" className="form-control" {...register('name')} placeholder="ex: Les adorateurs d'arkansiel" />
                                </div>
                                <div className="group-form">
                                    <label htmlFor="name" className="form-label">
                                        Description du village
                                    </label>
                                    <textarea cols={30} rows={5} className="form-control" {...register('description')} placeholder="Chill, RP sérieux..."></textarea>
                                </div>
                                <h4 className="my-3">Bannière</h4>
                                <div className="row my-3">
                                    {banners.map((img, index) => (
                                        <div key={index} onClick={() => {setBanner(img)}} className="col-sm-2 left-click">
                                            <img src={img} alt="" width={50} />
                                        </div>
                                    ))}
                                </div>
                                <h4 className="my-3">Emblème</h4>
                                <div className="row my-3">
                                    {emblems.map((img, index) => (
                                        <div key={index} onClick={() => {setEmblem(img)}} className="col-sm-2 left-click">
                                            <img src={img} alt="" width={50} />
                                        </div>
                                    ))}
                                </div>
                                <div className="d-grid gap-2 col-6 mx-auto">
                                    <input type="submit" value="Créer le village" className="btn btn-warning my-3" />
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
            <Footer />
        </div>
    )
}

export default CreateClan;